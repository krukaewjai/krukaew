<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö ‡∏õ‡∏û.5 ‡∏ß‡∏¥‡∏ä‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Sarabun', sans-serif;
            background-image: url('https://lh5.googleusercontent.com/d/1b4LjVnjjZ66DLn_pwYNCaiaKA9etAqCV'); 
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
 .loader { border: 4px solid #f3f3f3; border-radius: 50%; border-top: 4px solid #3498db; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal { transition: opacity 0.25s ease; }
        .class-btn { @apply bg-white hover:bg-indigo-50 border-2 border-indigo-200 hover:border-indigo-400 text-indigo-700 py-3 px-4 rounded-lg font-medium transition-all; }
        .student-class-btn { @apply bg-white hover:bg-green-50 border-2 border-green-200 hover:border-green-400 text-green-700 py-3 px-4 rounded-lg font-medium transition-all; }
        @media print { body * { visibility: hidden; } #studentResults, #studentResults * { visibility: visible; } #studentResults { position: absolute; left: 0; top: 0; width: 100%; padding: 20px; } .no-print { display: none; } .print-friendly { box-shadow: none !important; background: none !important; border: 1px solid #ddd; } }
    </style>
</head>
<body>
    <div class="container mx-auto px-4 py-8 no-print">
        <div class="text-center mb-8 bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-lg">
             <h1 class="text-4xl font-bold text-indigo-800 mb-2">üìä ‡∏£‡∏∞‡∏ö‡∏ö ‡∏õ‡∏û.5 ‡∏ß‡∏¥‡∏ä‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</h1>
             <p class="text-gray-600">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ.1 - ‡∏õ.6</p>
        </div>
        <div class="flex justify-center mb-8 space-x-4">
            <button id="teacherModeBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-medium transition-colors shadow-md">üë®‚Äçüè´ ‡πÇ‡∏´‡∏°‡∏î‡∏Ñ‡∏£‡∏π</button>
            <button id="studentModeBtn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors shadow-md">üë®‚Äçüéì ‡πÇ‡∏´‡∏°‡∏î‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
        </div>
        <div id="teacherMode">
            <div id="passwordSection" class="max-w-md mx-auto mb-8"><div class="bg-white rounded-lg shadow-lg p-6"><h3 class="text-xl font-semibold text-gray-800 mb-4 text-center">üîê ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h3><input type="password" id="passwordInput" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"><button id="loginBtn" class="w-full mt-4 bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-lg font-medium transition-colors">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button><div id="loginSpinner" class="hidden mx-auto mt-4 loader"></div></div></div>
            <div id="teacherDashboard" class="hidden"><div class="mb-6"><label class="block text-lg font-medium text-gray-700 mb-3 bg-white/70 backdrop-blur-sm p-2 rounded-md w-fit">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label><div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3"><button class="class-btn" data-class="‡∏õ.1">‡∏õ.1</button><button class="class-btn" data-class="‡∏õ.2">‡∏õ.2</button><button class="class-btn" data-class="‡∏õ.3">‡∏õ.3</button><button class="class-btn" data-class="‡∏õ.4">‡∏õ.4</button><button class="class-btn" data-class="‡∏õ.5">‡∏õ.5</button><button class="class-btn" data-class="‡∏õ.6">‡∏õ.6</button></div></div><div id="scoreManagement" class="hidden"><div class="bg-white rounded-lg shadow-lg p-6"><div class="flex flex-wrap justify-between items-center mb-6 gap-4"><h3 id="currentClass" class="text-2xl font-bold text-gray-800"></h3><div class="flex space-x-2"><button id="rosterBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">üìù ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button><button id="addScoreBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button></div></div><div id="addScoreForm" class="hidden mb-6 p-4 bg-gray-50 rounded-lg"><h4 class="font-semibold mb-3">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏´‡∏°‡πà</h4><div class="grid grid-cols-1 md:grid-cols-5 gap-4"><input type="text" id="studentId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà)" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"><input type="text" id="studentName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 bg-gray-100"><select id="scoreType" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</option><option value="collect">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö</option><option value="exam">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö</option></select><input type="text" id="subject" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠/‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"><input type="number" id="score" placeholder="‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô" min="0" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"></div><div class="flex space-x-3 mt-4"><button id="saveScoreBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button><button id="cancelAddBtn" type="button" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button></div></div><div class="overflow-x-auto"><table class="w-full table-auto"><thead><tr class="bg-gray-100"><th class="px-4 py-3 text-left font-semibold text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th class="px-4 py-3 text-left font-semibold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th class="px-4 py-3 text-left font-semibold text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th class="px-4 py-3 text-left font-semibold text-gray-700">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠/‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö</th><th class="px-4 py-3 text-left font-semibold text-gray-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th><th class="px-4 py-3 text-left font-semibold text-gray-700">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody id="scoresTable"></tbody></table><div id="tableSpinner" class="hidden mx-auto mt-8 loader"></div></div></div></div></div>
        </div>
        <div id="studentMode" class="hidden"><div class="max-w-6xl mx-auto"><div class="bg-white rounded-lg shadow-lg p-6"><h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3><div class="mb-6"><label class="block text-lg font-medium text-gray-700 mb-3 text-center">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</label><div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 mb-6"><button class="student-class-btn" data-class="‡∏õ.1">‡∏õ.1</button><button class="student-class-btn" data-class="‡∏õ.2">‡∏õ.2</button><button class="student-class-btn" data-class="‡∏õ.3">‡∏õ.3</button><button class="student-class-btn" data-class="‡∏õ.4">‡∏õ.4</button><button class="student-class-btn" data-class="‡∏õ.5">‡∏õ.5</button><button class="student-class-btn" data-class="‡∏õ.6">‡∏õ.6</button></div></div><div id="studentSearchSection" class="hidden"><div class="space-y-4 mb-6 max-w-md mx-auto"><input type="text" id="searchStudentId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"><button id="searchBtn" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-medium transition-colors">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button><div id="searchSpinner" class="hidden mx-auto mt-4 loader"></div></div></div></div></div></div>
    </div>
    <div id="studentResults"></div>
    <div id="editModal" class="modal no-print fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4"><div class="bg-white rounded-lg p-6 w-full max-w-md mx-auto"><h3 class="text-xl font-bold text-gray-800 mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3><div class="space-y-4"><input type="hidden" id="editScoreId"><input type="text" id="editStudentId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100" readonly><input type="text" id="editStudentName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="w-full px-3 py-2 border border-gray-300 rounded-lg"><select id="editScoreType" class="w-full px-3 py-2 border border-gray-300 rounded-lg"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</option><option value="collect">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö</option><option value="exam">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö</option></select><input type="text" id="editSubject" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠/‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö" class="w-full px-3 py-2 border border-gray-300 rounded-lg"><input type="number" id="editScore" placeholder="‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg"></div><div class="flex space-x-3 mt-6"><button id="saveEditBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button><button id="cancelEditBtn" type="button" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button></div></div></div>
    <div id="rosterModal" class="modal no-print fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4"><div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-auto max-h-[90vh] flex flex-col"><div class="flex justify-between items-center mb-4"><h3 id="rosterModalTitle" class="text-2xl font-bold text-gray-800"></h3><button id="closeRosterModalBtn" class="text-gray-500 hover:text-gray-800 text-3xl">√ó</button></div><div class="mb-6 p-4 bg-gray-50 rounded-lg"><h4 id="rosterFormTitle" class="font-semibold mb-3 text-lg">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà</h4><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><input type="hidden" id="rosterEditId"><input type="text" id="rosterStudentId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà)" class="px-3 py-2 border border-gray-300 rounded-lg"><input type="text" id="rosterStudentName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="px-3 py-2 border border-gray-300 rounded-lg md:col-span-2"></div><div class="flex space-x-3 mt-4"><button id="saveStudentBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button><button id="cancelEditStudentBtn" type="button" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium hidden">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></div></div><div class="flex-grow overflow-y-auto"><div id="rosterSpinner" class="hidden mx-auto mt-8 loader"></div><table class="w-full table-auto"><thead class="sticky top-0 bg-gray-100"><tr><th class="px-4 py-3 text-left font-semibold text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th class="px-4 py-3 text-left font-semibold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th class="px-4 py-3 text-left font-semibold text-gray-700">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody id="rosterTable"></tbody></table></div></div></div>
    
    <template id="studentResultTemplate">
        <div class="max-w-6xl mx-auto my-8 bg-white rounded-lg shadow-lg p-6 print-friendly"><div class="flex justify-between items-start mb-6"><div class="flex-grow"><h4 class="studentNameDisplay text-2xl font-bold text-gray-800 mb-2"></h4><p class="text-gray-600">üìä ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</p></div><button class="print-btn no-print bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded inline-flex items-center transition-colors"><span class="text-2xl mr-2">üñ®Ô∏è</span><span>‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span></button></div><div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6 mb-6 print-friendly"><h5 class="text-lg font-semibold text-gray-800 mb-4 text-center">‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</h5><div class="overflow-x-auto"><table class="w-full table-auto bg-white rounded-lg shadow-sm"><thead><tr class="bg-gray-100"><th class="px-6 py-4 text-center font-semibold text-gray-700 border-r">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö<br><span class="text-sm font-normal">(‡πÄ‡∏ï‡πá‡∏° 70)</span></th><th class="px-6 py-4 text-center font-semibold text-gray-700 border-r">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö<br><span class="text-sm font-normal">(‡πÄ‡∏ï‡πá‡∏° 30)</span></th><th class="px-6 py-4 text-center font-semibold text-gray-700 border-r">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°<br><span class="text-sm font-normal">(100 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</span></th><th class="px-6 py-4 text-center font-semibold text-gray-700">‡πÄ‡∏Å‡∏£‡∏î</th></tr></thead><tbody><tr class="text-center"><td class="collectScoreCell px-6 py-6 text-3xl font-bold text-blue-600 border-r">-</td><td class="examScoreCell px-6 py-6 text-3xl font-bold text-orange-600 border-r">-</td><td class="totalScoreCell px-6 py-6 text-3xl font-bold text-green-600 border-r">-</td><td class="gradeCell px-6 py-6 text-4xl font-bold text-purple-600">-</td></tr></tbody></table></div></div><div class="bg-white rounded-lg border border-gray-200 print-friendly"><div class="px-6 py-4 bg-gray-50 border-b border-gray-200"><h6 class="font-semibold text-gray-800">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏¥‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h6></div><div class="overflow-x-auto"><table class="w-full table-auto"><thead><tr class="bg-gray-100"><th class="px-4 py-3 text-left font-semibold text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th class="px-4 py-3 text-left font-semibold text-gray-700">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠/‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö</th><th class="px-4 py-3 text-center font-semibold text-gray-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th></tr></thead><tbody class="studentScoresTable"></tbody></table></div></div></div>
    </template>

    <script>
    // ######################################################################
    // ##  ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á URL ‡∏Ç‡∏≠‡∏á WEB APP ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ DEPLOY ‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ##
    // ######################################################################
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwpahpv8Yd0OUjEvP-VNiD95amXxtkeaQxTCzaXgZWNi3ya_9428Mi031aUvjRWe567xg/exec"; 
    
    // --- Helper function for making API calls ---
    async function callGoogleScript(action, payload = {}) {
        // For writing/updating data, we use POST
        if (['addScore', 'updateScore', 'deleteScore', 'addStudent', 'updateStudent', 'deleteStudent'].includes(action)) {
             try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action, payload }),
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    mode: 'no-cors' // Use no-cors for simple POST to prevent CORS errors
                });
                return { success: true }; // Assume success as we can't read the response
            } catch (error) {
                console.error("Fetch POST Error:", error);
                throw error;
            }
        } 
        // For reading data, we use GET
        else {
            const url = new URL(SCRIPT_URL);
            url.searchParams.append('action', action);
            url.searchParams.append('payload', JSON.stringify(payload));
            try {
                 const response = await fetch(url);
                 if (!response.ok) throw new Error(`Network error: ${response.statusText}`);
                 const result = await response.json();
                 if (!result.success) throw new Error(result.message || 'API script error.');
                 return result.data;
            } catch(error){
                console.error("Fetch GET Error:", error);
                throw error;
            }
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        let currentClass = '', selectedStudentClass = '', allClassScores = {}, allStudentsCache = {};
        const teacherModeDiv = document.getElementById('teacherMode'), studentModeDiv = document.getElementById('studentMode'), passwordSection = document.getElementById('passwordSection'), teacherDashboard = document.getElementById('teacherDashboard'), scoreManagementDiv = document.getElementById('scoreManagement'), addScoreForm = document.getElementById('addScoreForm'), studentIdInput = document.getElementById('studentId'), studentNameInput = document.getElementById('studentName'), rosterModal = document.getElementById('rosterModal');
        const handleError = error => { console.error('Error:', error); ['tableSpinner', 'searchSpinner', 'loginSpinner', 'rosterSpinner'].forEach(id => showLoadingSpinner(id, false)); alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message); };
        const showLoadingSpinner = (spinnerId, show) => { const spinner = document.getElementById(spinnerId); if (spinner) spinner.classList.toggle('hidden', !show); };
        const calculateGrade = totalScore => { if (totalScore >= 80) return '4'; if (totalScore >= 75) return '3.5'; if (totalScore >= 70) return '3'; if (totalScore >= 65) return '2.5'; if (totalScore >= 60) return '2'; if (totalScore >= 55) return '1.5'; if (totalScore >= 50) return '1'; return '0'; };
        const getScoreColor = score => { if (score >= 80) return 'bg-green-100 text-green-800'; if (score >= 70) return 'bg-yellow-100 text-yellow-800'; if (score >= 60) return 'bg-orange-100 text-orange-800'; return 'bg-red-100 text-red-800'; };
        const switchMode = mode => { teacherModeDiv.classList.toggle('hidden', mode !== 'teacher'); studentModeDiv.classList.toggle('hidden', mode !== 'student'); if (mode === 'teacher') document.getElementById('studentResults').innerHTML = ''; };
        
        document.getElementById('teacherModeBtn').addEventListener('click', () => switchMode('teacher'));
        document.getElementById('studentModeBtn').addEventListener('click', () => switchMode('student'));
        switchMode('teacher');

        document.getElementById('loginBtn').addEventListener('click', async () => {
            const password = document.getElementById('passwordInput').value;
            showLoadingSpinner('loginSpinner', true);
            try {
                const data = await callGoogleScript('verifyPassword', { password });
                if (data.success) { passwordSection.classList.add('hidden'); teacherDashboard.classList.remove('hidden'); } 
                else { alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!'); }
            } catch (error) { handleError(error); } 
            finally { showLoadingSpinner('loginSpinner', false); }
        });

        document.querySelectorAll('.class-btn').forEach(btn => { btn.addEventListener('click', () => { currentClass = btn.dataset.class; document.getElementById('currentClass').textContent = `‡∏´‡πâ‡∏≠‡∏á ${currentClass}`; scoreManagementDiv.classList.remove('hidden'); document.querySelectorAll('.class-btn').forEach(b => b.classList.remove('bg-indigo-100', 'border-indigo-500')); btn.classList.add('bg-indigo-100', 'border-indigo-500'); loadScoresForClass(currentClass); loadStudentsForClass(currentClass); }); });
        
        const loadStudentsForClass = async (className) => { try { const students = await callGoogleScript('getStudents', { className }); allStudentsCache[className] = students; return students; } catch(e){ handleError(e); return []; }};
        document.getElementById('rosterBtn').addEventListener('click', async () => { document.getElementById('rosterModalTitle').textContent = `‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏´‡πâ‡∏≠‡∏á ${currentClass}`; rosterModal.classList.remove('hidden'); await renderStudentRoster(); });
        const renderStudentRoster = async () => { const rosterTableBody = document.getElementById('rosterTable'); rosterTableBody.innerHTML = ''; showLoadingSpinner('rosterSpinner', true); try { const students = await loadStudentsForClass(currentClass); if (students.length === 0) { rosterTableBody.innerHTML = '<tr><td colspan="3" class="text-center py-8 text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ</td></tr>'; return; } students.sort((a,b) => String(a.studentId).localeCompare(String(b.studentId), undefined, {numeric: true})).forEach(student => { rosterTableBody.innerHTML += `<tr class="border-b border-gray-200"><td class="px-4 py-3">${student.studentId}</td><td class="px-4 py-3">${student.studentName}</td><td class="px-4 py-3"><button onclick="editStudent('${student.id}')" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm mr-2">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button><button onclick="deleteStudent('${student.id}')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">‡∏•‡∏ö</button></td></tr>`; }); } catch (error) { rosterTableBody.innerHTML = '<tr><td colspan="3" class="text-center py-8 text-red-500">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</td></tr>'; } finally { showLoadingSpinner('rosterSpinner', false); }};
        window.editStudent = studentRowId => { const student = allStudentsCache[currentClass]?.find(s => s.id === studentRowId); if (!student) return; document.getElementById('rosterFormTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'; document.getElementById('rosterEditId').value = student.id; document.getElementById('rosterStudentId').value = student.studentId; document.getElementById('rosterStudentName').value = student.studentName; document.getElementById('cancelEditStudentBtn').classList.remove('hidden'); rosterModal.querySelector('.flex-grow').scrollTop = 0; };
        window.deleteStudent = async (studentRowId) => { if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ?')) { showLoadingSpinner('rosterSpinner', true); try { await callGoogleScript('deleteStudent', { studentId: studentRowId }); await renderStudentRoster(); } catch (e) { handleError(e); } finally { showLoadingSpinner('rosterSpinner', false); } } };
        const clearRosterForm = () => { document.getElementById('rosterEditId').value = ''; document.getElementById('rosterStudentId').value = ''; document.getElementById('rosterStudentName').value = ''; document.getElementById('rosterFormTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà'; document.getElementById('cancelEditStudentBtn').classList.add('hidden'); };
        document.getElementById('saveStudentBtn').addEventListener('click', async () => { const studentData = { id: document.getElementById('rosterEditId').value, className: currentClass, studentId: document.getElementById('rosterStudentId').value.trim(), studentName: document.getElementById('rosterStudentName').value.trim() }; if (!studentData.studentId || !studentData.studentName) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'); return; } const apiCall = studentData.id ? 'updateStudent' : 'addStudent'; showLoadingSpinner('rosterSpinner', true); try { await callGoogleScript(apiCall, { studentData }); clearRosterForm(); await renderStudentRoster(); } catch (e) { handleError(e); } finally { showLoadingSpinner('rosterSpinner', false); } });
        document.getElementById('closeRosterModalBtn').addEventListener('click', () => rosterModal.classList.add('hidden'));
        document.getElementById('cancelEditStudentBtn').addEventListener('click', clearRosterForm);
        studentIdInput.addEventListener('blur', () => { const studentId = studentIdInput.value.trim(); const students = allStudentsCache[currentClass] || []; const foundStudent = students.find(s => String(s.studentId) == String(studentId)); studentNameInput.value = foundStudent ? foundStudent.studentName : ''; studentNameInput.classList.toggle('bg-green-100', !!foundStudent); });
        document.getElementById('addScoreBtn').addEventListener('click', () => addScoreForm.classList.remove('hidden'));
        const clearAddForm = () => { studentIdInput.value = ''; studentNameInput.value = ''; document.getElementById('scoreType').value = ''; document.getElementById('subject').value = ''; document.getElementById('score').value = ''; studentNameInput.classList.remove('bg-green-100'); };
        document.getElementById('cancelAddBtn').addEventListener('click', () => { addScoreForm.classList.add('hidden'); clearAddForm(); });
        const loadScoresForClass = async (className) => { const scoresTableBody = document.getElementById('scoresTable'); scoresTableBody.innerHTML = ''; showLoadingSpinner('tableSpinner', true); try { const scores = await callGoogleScript('getScores', { className }); renderScoresTable(scores); } catch (e) { handleError(e); } finally { showLoadingSpinner('tableSpinner', false); } };
        const renderScoresTable = scores => { const tbody = document.getElementById('scoresTable'); tbody.innerHTML = ''; showLoadingSpinner('tableSpinner', false); if (!scores || scores.length === 0) { tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ</td></tr>'; return; } allClassScores[currentClass] = scores; scores.forEach(score => { const scoreTypeText = score.scoreType === 'collect' ? '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö' : '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö'; const scoreTypeBadge = score.scoreType === 'collect' ? 'bg-blue-100 text-blue-800' : 'bg-orange-100 text-orange-800'; tbody.innerHTML += `<tr class="border-b border-gray-200 hover:bg-gray-50"><td class="px-4 py-3">${score.studentId}</td><td class="px-4 py-3">${score.studentName}</td><td class="px-4 py-3"><span class="inline-block px-2 py-1 rounded-full text-xs font-medium ${scoreTypeBadge}">${scoreTypeText}</span></td><td class="px-4 py-3">${score.subject}</td><td class="px-4 py-3"><span class="inline-block px-3 py-1 rounded-full text-sm font-medium ${getScoreColor(score.score)}">${score.score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span></td><td class="px-4 py-3"><button onclick="openEditModal('${score.id}')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm mr-2">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button><button onclick="confirmDeleteScore('${score.id}')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">‡∏•‡∏ö</button></td></tr>`; }); };
        document.getElementById('saveScoreBtn').addEventListener('click', async () => { const scoreData = { studentId: studentIdInput.value.trim(), studentName: studentNameInput.value.trim(), scoreType: document.getElementById('scoreType').value, subject: document.getElementById('subject').value.trim(), score: parseInt(document.getElementById('score').value), className: currentClass }; if (!scoreData.studentId || !scoreData.studentName || !scoreData.scoreType || !scoreData.subject || isNaN(scoreData.score)) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!'); return; } showLoadingSpinner('tableSpinner', true); try { await callGoogleScript('addScore', { scoreData }); addScoreForm.classList.add('hidden'); clearAddForm(); await loadScoresForClass(currentClass); } catch (e) { handleError(e); } finally { showLoadingSpinner('tableSpinner', false); } });
        window.openEditModal = scoreId => { const score = allClassScores[currentClass]?.find(s => s.id == scoreId); if (!score) return; document.getElementById('editScoreId').value = score.id; document.getElementById('editStudentId').value = score.studentId; document.getElementById('editStudentName').value = score.studentName; document.getElementById('editScoreType').value = score.scoreType; document.getElementById('editSubject').value = score.subject; document.getElementById('editScore').value = score.score; document.getElementById('editModal').classList.remove('hidden'); };
        window.confirmDeleteScore = async scoreId => { if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) { showLoadingSpinner('tableSpinner', true); try { await callGoogleScript('deleteScore', { scoreId }); await loadScoresForClass(currentClass); } catch (e) { handleError(e); } finally { showLoadingSpinner('tableSpinner', false); } } };
        document.getElementById('saveEditBtn').addEventListener('click', async () => { const scoreData = { id: document.getElementById('editScoreId').value, studentId: document.getElementById('editStudentId').value, studentName: document.getElementById('editStudentName').value.trim(), scoreType: document.getElementById('editScoreType').value, subject: document.getElementById('editSubject').value.trim(), score: parseInt(document.getElementById('editScore').value), className: currentClass }; if (!scoreData.studentName || !scoreData.scoreType || !scoreData.subject || isNaN(scoreData.score)) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô!'); return; } showLoadingSpinner('tableSpinner', true); document.getElementById('editModal').classList.add('hidden'); try { await callGoogleScript('updateScore', { scoreData }); await loadScoresForClass(currentClass); } catch (e) { handleError(e); } finally { showLoadingSpinner('tableSpinner', false); } });
        document.getElementById('cancelEditBtn').addEventListener('click', () => document.getElementById('editModal').classList.add('hidden'));
        document.querySelectorAll('.student-class-btn').forEach(btn => { btn.addEventListener('click', () => { selectedStudentClass = btn.dataset.class; document.getElementById('studentSearchSection').classList.remove('hidden'); document.querySelectorAll('.student-class-btn').forEach(b => b.classList.remove('bg-green-100', 'border-green-500')); btn.classList.add('bg-green-100', 'border-green-500'); document.getElementById('studentResults').innerHTML = ''; }); });
        document.getElementById('searchBtn').addEventListener('click', async () => { const studentId = document.getElementById('searchStudentId').value.trim(); if (!studentId || !selectedStudentClass) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô!'); return; } showLoadingSpinner('searchSpinner', true); document.getElementById('studentResults').innerHTML = ''; try { const scores = await callGoogleScript('getStudentScores', { studentId, className: selectedStudentClass }); displayStudentResults(scores); } catch (e) { handleError(e); } finally { showLoadingSpinner('searchSpinner', false); } });
        const displayStudentResults = studentScores => { const resultsDiv = document.getElementById('studentResults'); const template = document.getElementById('studentResultTemplate'); resultsDiv.innerHTML = ''; if (studentScores.length === 0) { resultsDiv.innerHTML = `<div class="max-w-6xl mx-auto my-8"><p class="text-center py-8 text-gray-500 bg-white rounded-lg shadow p-6">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p></div>`; } else { const clone = template.content.cloneNode(true); const collectScores = studentScores.filter(s => s.scoreType === 'collect'), examScores = studentScores.filter(s => s.scoreType === 'exam'); const totalRawCollect = collectScores.reduce((sum, s) => sum + Number(s.score), 0), totalRawExam = examScores.reduce((sum, s) => sum + Number(s.score), 0); const finalCollectScore = Math.min(totalRawCollect, 70), finalExamScore = Math.min(totalRawExam, 30); const totalScore = finalCollectScore + finalExamScore; clone.querySelector('.studentNameDisplay').textContent = studentScores[0].studentName; clone.querySelector('.collectScoreCell').textContent = finalCollectScore.toFixed(2); clone.querySelector('.examScoreCell').textContent = finalExamScore.toFixed(2); clone.querySelector('.totalScoreCell').textContent = totalScore.toFixed(2); clone.querySelector('.gradeCell').textContent = calculateGrade(totalScore); const detailedTableBody = clone.querySelector('.studentScoresTable'); detailedTableBody.innerHTML = studentScores.map(score => { const scoreTypeText = score.scoreType === 'collect' ? '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö' : '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö'; const scoreTypeBadge = score.scoreType === 'collect' ? 'bg-blue-100 text-blue-800' : 'bg-orange-100 text-orange-800'; return `<tr class="border-b border-gray-200 hover:bg-gray-50"><td class="px-4 py-3"><span class="inline-block px-2 py-1 rounded-full text-xs font-medium ${scoreTypeBadge}">${scoreTypeText}</span></td><td class="px-4 py-3">${score.subject}</td><td class="px-4 py-3 text-center"><span class="inline-block px-3 py-1 rounded-full text-sm font-medium ${getScoreColor(score.score)}">${score.score}</span></td></tr>`; }).join(''); resultsDiv.appendChild(clone); resultsDiv.querySelector('.print-btn')?.addEventListener('click', () => window.print()); } };
    });
    </script>
</body>
</html>       




